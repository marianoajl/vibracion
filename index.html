<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vibración Intermitente</title>
    <style>
        /* Estilos iguales hasta la animación */

        .vibrating {
            animation: shake 0.5s linear;
        }

        @keyframes shake {
            0% { transform: translateX(0) rotate(45deg); }
            25% { transform: translateX(-5px) rotate(45deg); }
            50% { transform: translateX(5px) rotate(45deg); }
            75% { transform: translateX(-5px) rotate(45deg); }
            100% { transform: translateX(0) rotate(45deg); }
        }

        /* ... resto de estilos ... */
    </style>
</head>
<body>
    <div class="container">
        <!-- ... mismo HTML ... -->
            <h1>Vibración Intermitente</h1>
        
        <div class="x-container">
            <div class="x-image" id="xImage">
                ✕
            </div>
        </div>

        <div class="controls">
            <button id="startBtn">Iniciar Vibración</button>
            <button id="stopBtn" disabled>Detener Vibración</button>
        </div>

        <div class="status" id="status">
            <span class="pulse"></span>
            Vibrando cada 3 segundos...
        </div>

        <div class="warning">
            ⚠️ Nota: La vibración solo funciona en dispositivos móviles que soportan la API de vibración.
        </div>
    </div>

    <script>
        // Elementos del DOM
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const xImage = document.getElementById('xImage');
        const status = document.getElementById('status');
        
        // Variables de control
        let vibrationTimeout = null;
        let isVibrating = false;

        // Verificar si la API de vibración está disponible
        const canVibrate = 'vibrate' in navigator;

        // Duración de la vibración y del ciclo
        const VIBRATION_DURATION = 500;
        const CYCLE_DURATION = 3000; // 3 segundos

        // Función para iniciar la vibración
        function startVibration() {
            if (!canVibrate) {
                alert('Tu dispositivo no soporta la API de vibración');
                return;
            }

            if (!isVibrating) {
                isVibrating = true;
                startBtn.disabled = true;
                stopBtn.disabled = false;
                status.style.display = 'block';
                
                // Función que realiza un ciclo de vibración
                function vibrateCycle() {
                    if (!isVibrating) return;
                    
                    // Activar vibración por 500ms
                    navigator.vibrate(VIBRATION_DURATION);
                    
                    // Activar animación de la X
                    xImage.classList.add('vibrating');
                    // Quitar la clase después de 500ms para permitir que se vuelva a activar en el próximo ciclo
                    setTimeout(() => {
                        xImage.classList.remove('vibrating');
                    }, VIBRATION_DURATION);
                    
                    // Programar el próximo ciclo después de CYCLE_DURATION (desde el inicio de este ciclo)
                    vibrationTimeout = setTimeout(vibrateCycle, CYCLE_DURATION);
                }
                
                // Iniciar el primer ciclo
                vibrateCycle();
            }
        }

        // Función para detener la vibración
        function stopVibration() {
            if (isVibrating) {
                isVibrating = false;
                clearTimeout(vibrationTimeout);
                navigator.vibrate(0); // Detener vibración actual
                xImage.classList.remove('vibrating');
                startBtn.disabled = false;
                stopBtn.disabled = true;
                status.style.display = 'none';
            }
        }

        // Event Listeners
        startBtn.addEventListener('click', startVibration);
        stopBtn.addEventListener('click', stopVibration);

        // Detener vibración al salir de la página
        window.addEventListener('beforeunload', stopVibration);
        window.addEventListener('pagehide', stopVibration);
    </script>
</body>
</html>